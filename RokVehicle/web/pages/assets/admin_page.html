<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Settings - Rokenbok Vehicle</title>
    <link rel="icon" href="/assets/favicon.ico">
</head>

<body>
    {{ header_nav }}
    <div style='max-width:600px;margin:32px auto 0 auto;'>
        <h2>Admin Settings</h2>

        {{ led_status }}

        <form method="POST" action="/admin">
            <label>Vehicle Type:</label><br>
            <select name="vehicleType" id="vehicleType" onchange="updateVehicleTag()">{{ type_option }}</select><br><br>
            <label>Vehicle Tag:</label><br>
            <input name="vehicleTag" id="vehicleTag" value="{{ vehicle_tag }}"><br><br>
            <label>Vehicle Name:</label><br>
            <input name="vehicleName" value="{{ vehicle_name }}"><br><br>

            <div
                style="border: 1px solid #ccc; padding: 15px; margin: 15px 0; border-radius: 5px; background: #f9f9f9;">
                <h3 style="margin-top: 0; color: #333;">LED Configuration</h3>
                <label>
                    <input type="checkbox" name="ledEnabled" id="ledEnabled" {{ led_enabled_checked }}>
                    Enable LED Status Indicator
                </label><br><br>

                <label>LED Pin:</label><br>
                <select name="ledPin" id="ledPin" style="margin-bottom: 10px;">
                    {{ led_pin_options }}
                </select><br>

                <div style="color: #666; font-size: 0.9em; margin-top: 5px;">
                    <em>Note: Grayed out pins are currently used by motors.
                        Update motor pin configuration on the Motor Config page to free up pins.</em>
                </div>
            </div>

            <button type="submit" name="save" value="1">Save</button>
            <button type="submit" name="cancel" value="1">Cancel</button>
        </form>
    </div>

    <script>

        // Vehicle type mapping (typeName -> tagName)
        const vehicleTypeMap = JSON.parse('{{ vehicle_type_map }}');

        function updateVehicleTag() {
            const typeSelect = document.getElementById('vehicleType');
            const tagInput = document.getElementById('vehicleTag');
            const selectedType = typeSelect.value;
            const newTagName = vehicleTypeMap[selectedType] || selectedType;

            // Use the current tag value, not just the original
            const currentTag = tagInput.value;
            let suffix = "";
            let matchedPrefix = null;
            for (const [typeName, tagName] of Object.entries(vehicleTypeMap)) {
                if (currentTag.startsWith(tagName + "-")) {
                    suffix = currentTag.substring(tagName.length + 1);
                    matchedPrefix = tagName;
                    break;
                }
            }

            // Only update if the tag matches the previous type prefix
            if (matchedPrefix) {
                tagInput.value = suffix ? newTagName + "-" + suffix : newTagName;
            }
            // If no match, do not auto-update (user has manually edited)
        }
    </script>
</body>

</html>