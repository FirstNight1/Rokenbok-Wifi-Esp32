<html>

<head>
    <title>Play Control</title>
    <link rel="stylesheet" href="/assets/play_page.css">
    <link rel="stylesheet" href="/assets/mapping_modal.css">
    <script src="/assets/play_page.js"></script>
</head>

<body>
    {{ header_nav }}
    <div class="main-flex">
        <div class="video-area" id="video_area">
            <div id="video_container">
                <!-- Video rendering will be handled by JS -->
            </div>
        </div>
        <div class="sidebar">
            <div class="section">
                <h2>Vehicle Info</h2>
                <div><b>Name:</b> {{ vehicle_name }}</div>
                <div><b>Type:</b> {{ vehicle_type }}</div>
            </div>
            <div class="section">
                <h2 id="control_mapping_header">Control Mapping</h2>
                <div style="margin-bottom:6px;">
                    <span style="font-weight:600;">Current Drive Mode:</span>
                    <span id="drive_mode_indicator" style="color:#1976d2;">{{ drive_mode }}</span>
                </div>
                <button id="toggle_mode_btn" class="btn">Toggle D-Pad/Tank</button>
                <div id="vehicle_status_indicator" class="status-indicator status-disconnected">
                    Vehicle Disconnected
                </div>
                <div id="conn_status" style="display:none"></div>
            </div>
            <div class="section">
                <h2>View Selection</h2>
                <div class="view-btns">
                    <button id="view_area_btn" class="btn">Area Camera</button>
                    <button id="view_fpv_btn" class="btn">FPV Camera</button>
                    <button id="view_pip_btn" class="btn">Picture in Picture</button>
                    <button id="flip_pip_btn" class="btn pip-flip-btn">Flip PIP</button>
                </div>
                <div style="margin-top:10px">
                    <label>Area Camera IP:</label><br>
                    <input type="text" id="area_ip" value="{{ area_ip }}" placeholder="e.g. 192.168.1.100">
                    <br>
                    <label>FPV Camera IP:</label><br>
                    <input type="text" id="fpv_ip" value="{{ fpv_ip }}" placeholder="e.g. 192.168.1.101">
                    <br>
                    <button id="save_ips_btn" class="btn save-btn">Save Camera IPs</button>
                </div>
            </div>
            <div class="section bt-section">
                <h2>Local Controller</h2>
                <div style="margin-bottom:8px;">
                    <label for="gamepad_select">Select Controller:</label><br>
                    <select id="gamepad_select" style="width:90%;margin-top:4px;"></select>
                </div>
                <div id="gamepad_status" style="font-size:0.95em;color:#888;">Press a button on the controller to
                    detect.</div>
                <button id="rescan_gamepads_btn" class="btn">Rescan</button>
            </div>
            <div id="browser_controller_section" class="section bt-section">
                <!-- Gamepad state will be rendered here -->
            </div>
            <div class="section bt-section">
                <h2>Bluetooth Controller</h2>
                <div style="color:#888;">Functionality not yet implemented.</div>
            </div>
        </div>
    </div>
</body>

</html>