
## Vehicle Hardware Conversion - FPV Camera
This conversion is mostly reversible, as other than running a few wires and maybe drilling a few holes, it doesn't impact the existing control board setup.  You will need basic soldering skills, and a willingness to take your vehicle apart, including potentially damaging it irreparably.  

1. The Vehicle Info folder contains information and pictures of the vehicles modified so far, more pictures and information will be added as we convert more vehicles.  This information may also be useful for repairs to the vehicle.

Parts used:
1x SeeedStudio XIAO ESP32-S3 Sense controller board with camera, flashed with Micropython and then the latest RokVision release (Instructions included in a Readme.md in RokVision)
(Wire - suggest 22 or 24ga, mounting tape or glue, solder, and other miscellanious electronics bits may be required)
(This project requires basic soldering skills)

**IMPORTANT FIRMWARE REQUIREMENT:** The XIAO ESP32-S3 Sense requires special MicroPython firmware that includes camera support. The standard MicroPython firmware does not support the camera module. You MUST flash the camera-compatible firmware from the cnadler86/micropython-camera-API project before uploading the RokVision code. Complete setup instructions are provided in RokVision/Readme.md.

2. Navigate to the Vehicle Info page for the vehicle you are looking to modify.  It will contain the mechanical steps and pictures needed to disassemble the vehicle.  You likely will not need to disassemble the vehicle further than removing the drive base.  For the best wire routing, you may wish however to disassemble the vehicle further to expose the best wire route.
3. A wiring diagram and list is included in the base vehicle information page, the FPV wiring is the same for each vehicle, though the vehicle specifc pages may have additional information or pictures on FPV wire routing. The wiring diagram has a separate schematic with the additions for the FPV highlighted.
  * You basically only need to connect a power and ground to the FPV board.  If you are using the stock controller board, I strongly suggest either not making this modification or adding a separate switch in-line as well to turn off the FPV controller, so you don't drain the batteries (the stock controller board uses the radio key to sleep, which currently isn't supported on using here as a sleep signal - leave a note if this is strongly desired and it could be worked out).  The easier method I'd suggest if using an FPV camera with a stock vehicle controller is to use a separate small battery such as an Anker Nano power bank to power the FPV board, and just insert those together into the front of the vehicle, which is usually sized fairly sufficiently for it.  The camera angle is able to be rotated in case you wind up using a battery pack and it makes the camera sideways or upside down.

4. After completing the hardware modifications, it is important to verify all wiring connections prior to powering on the vehicle.  Take a minute and double check your wiring against the circuit diagrams, and ensure all connections make sense (i.e. you aren't shorting the battery leads together anywhere).
5. Hopefully you flashed the camera-compatible MicroPython firmware and RokVision software onto the controller before you put it in the vehicle, otherwise dig up a usb-c cord (right angle ones are available and can be helpful if you glued yourself into a jam) and follow those instructions in the RokVision project now. **Note:** The camera requires special firmware - see RokVision/Readme.md for complete setup instructions.

6. On initial startup of a new FPV board, it will create a Wifi Access Point (AP) that looks like FPV-loader-XYZABC.  This network name is the tag for the vehicle, and consists of "FPV-", the vehicle type, and it's unique tag.  The default vehicle type is loader, we'll update this shortly.  Connect a phone or computer to the access point.  The default password for the access point is 1234567890.  The camera should have an IP address of 192.168.4.1, and should assign your device an IP address of 192.168.4.2.
7. Open Chrome (or an internet browser) on the device, and navigate to http://192.168.4.1, which should load the home page for the FPV Camera, and show various information about the controller.
8. Navigate to the Admin page link in the header, which will take you to a page where you can configure the general settings for the camera.  You can set the broadcast quality, bitrate, size, whether the camera should be able to sleep, the associated vehicle type, and more from this page.  Since most FPV cameras will be associated to a specific vehicle, I prefer to give it the same vehicle type as the vehicle it is providing FPV for. Select the correct vehicle type from the list.  When you select a vehicle type from the list, it will update the tag prefix as well.  I suggest keeping the same tag, but you can also set a custom tag if desired, ensure it is unique for each vehicle and FPV camera (keep the FPV- prefix).  You can also set a "friendly name" for the camera, useful to differentiate Power Sweeper 1 FPV and Power Sweeper 2 FPV if you have multiple, for example.  Click save to save your updates.  The change to the AP network name to match the new tag will NOT take effect until the vehicle is rebooted.
9. The FPV camera usually does not make sense to keep in AP mode, it's really only useful if you have a device that will ONLY be displaying the FPV stream, then you can connect that device to the vehicle's AP directly.  Most often, you will connect the FPV camera as a client of the vehicle's AP if you're running the vehicle in AP mode, or to your home network.  Either way for those, you'll use the wifi page to set the network name and password (the default vehicle AP is the tag, loader-XYZABC, and password 1234567890).  Go ahead and reboot the FPV camera to connect it to the new network.  If associated to a vehicle's AP, it will likely be assigned an IP of 192.168.4.3, or .4.2 if you haven't connected a device to the vehicle, and will be accessible to other devices on the vehicle's network.  If you're connected to your home wifi, see the notes in the vehicle conversion section about finding the FPV camera's IP and setting it to static, it's all the same. Note the IP address of the FPV camera.
  * When the FPV camera boots up, it will attempt 5 times to connect to the wifi network, if configured.  If it is unable to connect to the network, it will "fall back" to AP mode, and you will see a network with the tag of the camera, just like in step 6.  You can use this to check and correct any errors in the wifi settings.  Or also works great if you travel with the camera and need to use it away from your configured network, it will quickly fall into AP mode so you can reconfigure it that way.
NOTE: If you get stuck on a bad wifi network or set a bad static IP or similar, reboot the camera 3 times in rapid succession (less than 20 seconds between reboots), and it will force the camera into AP mode, so you can connect back and edit the wifi/IP settings.  Note that this will not clear your stored wifi network and credentials, so future reboots will still attempt to connect back to the configured network unless you make edits.
10. The FPV camera should now be connected to your network or the vehicle's network, or you are using it in AP mode.  You can re-navigate to the admin page to configure any settings for the stream, and can also (if enabled) start and shutdown the camera stream from that page.  There is also a camera testing page that will show you the output of your stream as well, so you can test.  For the most part, you won't be accessing anything on this once you get the stream/camera configured, you just need the IP address of the FPV camera to use on the vehicle or server Play pages, which has a box for you to enter that IP address.  The FPV camera IP address and "stream address" to enter on those pages is displayed prominently on the home page.